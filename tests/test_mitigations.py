from pwn import ELF

from automatic_exploit_generation import mitigations


def test_mitigations() -> None:
    elf = ELF("others/essay-checker.elf")

    found_mitigations = list(mitigations.get_mitigations(elf))
    assert found_mitigations == [mitigations.Mitigation.RELRO]


def test_context() -> None:
    elf = ELF("others/essay-checker.elf")

    context = list(mitigations.get_context_aspects(elf))
    assert context == [
        mitigations.ContextAspects.EXECSTACK,
        mitigations.ContextAspects.RWX_SEGMENTS,
    ]
